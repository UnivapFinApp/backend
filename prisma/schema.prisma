// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String        @id @default(ulid())
  name         String
  email        String        @unique
  password     String
  isActive     Boolean       @default(true)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @default(now())
  transactions Transaction[]
}

model Category {
  id           String        @id @default(ulid())
  name         String
  transactions Transaction[]
  isActive     Boolean       @default(true)
}

enum TransactionType {
  INCOME
  EXPENSE
}

model Transaction {
  id String @id @default(ulid())

  description String
  type        TransactionType
  amount      Decimal         @db.Money
  User        User            @relation(fields: [userId], references: [id])
  userId      String
  Category    Category        @relation(fields: [categoryId], references: [id])
  categoryId  String
  date        DateTime
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @default(now())
  isActive    Boolean         @default(true)
}

/**
 * CREATE TABLE categories (
 * id UUID PRIMARY KEY,
 * user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
 * name VARCHAR(50) NOT NULL,
 * created_at TIMESTAMP DEFAULT NOW(),
 * CONSTRAINT uq_user_category UNIQUE (user_id, name)
 * );
 * CREATE TABLE transactions (
 * id UUID PRIMARY KEY,
 * user_id UUID REFERENCES users(id) ON DELETE CASCADE,
 * account_id UUID REFERENCES accounts(id) ON DELETE RESTRICT,
 * description VARCHAR(200) NOT NULL,
 * type VARCHAR(10) CHECK (type IN ('income', 'expense')) NOT NULL,
 * amount DECIMAL(12, 2) CHECK (amount > 0) NOT NULL,
 * category_id UUID REFERENCES categories(id) ON DELETE SET NULL,
 * ai_category VARCHAR(50),
 * date DATE NOT NULL,
 * created_at TIMESTAMP DEFAULT NOW(),
 * updated_at TIMESTAMP DEFAULT NOW()
 * );
 */
